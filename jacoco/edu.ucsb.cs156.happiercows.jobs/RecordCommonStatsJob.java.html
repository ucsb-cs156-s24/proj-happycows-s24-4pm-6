<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RecordCommonStatsJob.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">happycows</a> &gt; <a href="index.source.html" class="el_package">edu.ucsb.cs156.happiercows.jobs</a> &gt; <span class="el_source">RecordCommonStatsJob.java</span></div><h1>RecordCommonStatsJob.java</h1><pre class="source lang-java linenums">package edu.ucsb.cs156.happiercows.jobs;

import edu.ucsb.cs156.happiercows.entities.Commons;
import edu.ucsb.cs156.happiercows.entities.CommonStats;
import edu.ucsb.cs156.happiercows.repositories.CommonsRepository;
import edu.ucsb.cs156.happiercows.services.CommonStatsService;
import edu.ucsb.cs156.happiercows.services.jobs.JobContext;
import edu.ucsb.cs156.happiercows.services.jobs.JobContextConsumer;
import lombok.AllArgsConstructor;
import lombok.Getter;


/** This job computes the stats for all games in progress and creates one new row in the CommonsStats table for each commons.   It uses the Average Cow Health Service to compute the cowhealth for each commons.
*/

@AllArgsConstructor
public class RecordCommonStatsJob implements JobContextConsumer {

    @Getter
    private CommonStatsService commonStatsService;

    @Getter
    private CommonsRepository commonsRepository;

    @Override
    public void accept(JobContext ctx) throws Exception {
<span class="fc" id="L27">        ctx.log(&quot;Starting record common stats job...&quot;);</span>
<span class="fc" id="L28">        Iterable&lt;Commons&gt; allCommons = commonsRepository.findAll();</span>

<span class="fc bfc" id="L30" title="All 2 branches covered.">        for (Commons commons : allCommons) {</span>
<span class="fc" id="L31">            ctx.log(String.format(&quot;Starting Commons id=%d (%s)...&quot;, commons.getId(), commons.getName()));</span>
<span class="fc" id="L32">            CommonStats commonStats = commonStatsService.createAndSaveCommonStats(commons.getId());</span>
<span class="fc" id="L33">            ctx.log(String.format(&quot;CommonStats %d for commons id=%d (%s) finished.&quot;, commonStats.getId(), commons.getId(),</span>
<span class="fc" id="L34">                    commons.getName()));</span>
<span class="fc" id="L35">        }</span>
<span class="fc" id="L36">        ctx.log(&quot;Record common stats job done!&quot;);</span>
<span class="fc" id="L37">    }</span>
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>